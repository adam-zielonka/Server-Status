<!DOCTYPE html>
<html lang="pl">
<head>
<title>Status</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css">
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"></script>
<style>
.container-fluid {
    padding: 15px;
}
.progress{
  height: 1.5rem
}
</style>
<script>
  var info = {}
  var block = []

  info.setDisable = module => {
    $('.reload', '#' + module).attr('disabled',true);
    $('.card-body', '#' + module).css('opacity','.4');
  }

  info.setEnable = module => {
    $('.reload', '#' + module).removeAttr('disabled');
    $('.card-body', '#' + module).css('opacity','1');
  }

  info.getMemory = () => {
    var module = 'memory';
    if(!block[module]) {
      block[module] = true;
        info.setDisable(module)
        $.get('os/memory', function (data) {
            var $box = $('#' + module);
            info.insertDatas($box, module, data);

            $('#memory-progress-used', $box)
            .css('width', data.percent_used + '%')
            .html(data.percent_used + '%')
            .attr('aria-valuenow', data.percent_used);

            $('#memory-progress-buffers', $box)
            .css('width', data.percent_buffers + '%')
            .html(data.percent_buffers + '%')
            .attr('aria-valuenow', data.percent_buffers);

            $('#memory-progress-cached', $box)
            .css('width', data.percent_cached + '%')
            .html(data.percent_cached + '%')
            .attr('aria-valuenow', data.percent_cached);

            info.setEnable(module)
            block[module] = false;

        }, 'json');
    }
  }

  info.getAll = function () {
      info.getMemory();
  }

  info.insertDatas = function ($box, block, datas) {
      for (var item in datas) {
          $('#' + block + '-' + item, $box).html(datas[item]);
      }
  }

  info.mapping = {
      all: info.getAll,
      memory: info.getMemory,
  };
</script>
</head>
<body>

<nav class="navbar navbar-light bg-light justify-content-between">
  <a class="navbar-brand" href="/">Status</a>
  <button type="button" onclick="info.getAll()" class="reload btn btn-info">Reload</button>
</nav>

<div class="container-fluid">

  <div class="card" id="memory">
    <div class="card-header">
      <h4>
        Memory
        <button type="button" onclick="info.getMemory()" class="reload btn btn-info float-right">Reload</button>
      </h4>
    </div>
    <div class="card-body">
    <table class="table table-striped">
        <tbody>
          <tr>
            <td style="width:0;">Used&nbsp;%</td>
            <td>
              <div class="progress">
                <div id="memory-progress-used" class="progress-bar bg-success" role="progressbar" aria-valuenow="0"
                aria-valuemin="0" aria-valuemax="100" style="width:0%">
                  0%
                </div>
                <div id="memory-progress-buffers" class="progress-bar" role="progressbar" aria-valuenow="0"
                aria-valuemin="0" aria-valuemax="100" style="width:0%">
                  0%
                </div>
                <div id="memory-progress-cached" class="progress-bar bg-info" role="progressbar" aria-valuenow="0"
                aria-valuemin="0" aria-valuemax="100" style="width:0%">
                  0%
                </div>
              </div>
            </td>
          </tr>
          <tr>
            <td>Used</td>
            <td id="memory-used"></td>
          </tr>
          <tr>
            <td>Free</td>
            <td id="memory-free"></td>
          </tr>
          <tr>
            <td>Buffers</td>
            <td id="memory-buffers"></td>
          </tr>
          <tr>
            <td>Cached</td>
            <td id="memory-cached"></td>
          </tr>
          <tr>
            <td>Total&nbsp;Free</td>
            <td id="memory-total_free"></td>
          </tr>
          <tr>
            <td>Total</td>
            <td id="memory-total"></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

</div>

<script>
  info.getAll();
</script>
</body>
</html>
